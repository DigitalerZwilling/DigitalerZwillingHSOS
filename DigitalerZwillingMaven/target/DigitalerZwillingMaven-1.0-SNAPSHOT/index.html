<html>
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>
  <body id="body"> 
      <table id="attributes" border="0"></table><br/>
      <div id="lists"></div>
  </body>
  
  <script language="javascript"> 
      //Browserunterstuetzung vorhanden?
      var browserSupport = ("WebSocket" in window) ? true : false;
            
      //Deklariere WebSocket
       var host = "ws://localhost:8080/DigitalerZwilling/";     
      
      
    function createAttributes(attribute, id){
        var attributes = document.getElementById("attributes");
        
        
        for(var i=0; i<attribute.length; i++){
            var zeile = document.createElement("tr");
            var name = document.createElement("td");
            name.innerHTML = attribute[i];
            zeile.appendChild(name);

            var value = document.createElement("td");
            value.id = id[i];
            zeile.appendChild(value);

            attributes.appendChild(zeile);
        }
    }
        
    function createLists(list_tilte, list_id, list_header){
        if(list_tilte.length !== list_id.length) return;
        
        var lists = document.getElementById("lists");
        
        for(var i=0; i<list_tilte.length; i++){
            var name = document.createTextNode(list_tilte[i]);
            lists.appendChild(name);
            var table = document.createElement("table");
            table.id = list_id[i];            
            lists.appendChild(table);
            lists.appendChild(document.createElement("br"));
            setHeader(list_header[i], table);
        }
        
    }
    
    function removeList(parent){
            var childs = parent.childNodes;
            
            while(childs.length>1){
                parent.removeChild(childs[1]);
            }
    }
    
    function setHeader(headerlist, parentNode){
            var tr = document.createElement("tr");
            for(var i=0; i<headerlist.length; i++){
                var th = document.createElement("th");
                th.innerHTML = headerlist[i];
                tr.appendChild(th);
            }
            parentNode.appendChild(tr);
    }
    
    function addLine(jsonObject, attributes, parentNode){
            var zeile = document.createElement("tr");
            for(var k=0; k<attributes.length; k++){
                var element = document.createElement("td");
                element.innerHTML = jsonObject[attributes[k]];
                zeile.appendChild(element);
            }
            parentNode.appendChild(zeile);
    }
    
 
    
    function updateAttributes(attribute_id, jsonString){
        var json = JSON.parse(jsonString);
        
        //Update Attributes
        for(var i=0; i<attribute_id.length; i++){
            var element = document.getElementById(attribute_id[i]);
            element.innerHTML = json[attribute_id[i]];
        }
    }
    
    function updateList(id, list_id, jsonString, childAttributes, objectIDs){        
        var json = JSON.parse(jsonString);
        var parent = document.getElementById(list_id);
        removeList(parent);
        
        for(var i=0; i<json.inhalt.length; i++){
            var ids = json.inhalt[i][objectIDs];
            for(var j=0; j<ids.length; j++){
                if(ids[j]==id){
                    addLine(json.inhalt[i],childAttributes,parent);
                }
            }
        }
    }
    
    function create(attribute_title, attribute_id, list_title, list_id, list_header){
        createAttributes(attribute_title,attribute_id);
        createLists(list_title, list_id, list_header);
    }
    
    function initArtikel(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter'];

        //Einzelne Tabellen:
        var list_title = ['Wartenträger' ];
        var list_id    = ['wartentraeger'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel']];
        var list_attribute = [['bezeichnung', 'zeitstempel']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var ArtikelWebSocket = new WebSocket(host+"ArtikelWebSocket");
        var WarentraegerWebSocket = new WebSocket(host+"WarentraegerWebSocket");

        ArtikelWebSocket.onopen = function() {
                ArtikelWebSocket.send(id);
            };

        WarentraegerWebSocket.onopen = function() {
                WarentraegerWebSocket.send("LIST");
            };

        ArtikelWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        WarentraegerWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"artikelIDs");
        };
    }
    
    function initSensor(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Störung', 'phy. Adresse', 'Zustand'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'stoerung', 'phy_adresse', 'zustand'];

        //Einzelne Tabellen:
        var list_title = ['Sektoren' ];
        var list_id    = ['sektoren'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel', 'Störung']];
        var list_attribute = [['bezeichnung', 'zeitstempel', 'stoerung']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var SensorWebSocket = new WebSocket(host+"SensorWebSocket");
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        
        SensorWebSocket.onopen = function() {
                SensorWebSocket.send(id);
            };

        SektorWebSocket.onopen = function() {
                SektorWebSocket.send("LIST");
            };

        SensorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"sensorIDs");
        };
    }
    
    function initWarentraeger(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Störung', 'Abstand', 'Montagezustand'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'stoerung', 'abstand_mm', 'montagezustand'];

        //Einzelne Tabellen:
        var list_title = ['Artikel', 'Transportband', 'Sektoren'];
        var list_id    = ['artikel', 'transportband', 'sektoren'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel'],['Bezeichnung', 'Zeitstempel','Störung'],['Bezeichnung', 'Zeitstempel','Störung']];
        var list_attribute = [['bezeichnung', 'zeitstempel'],['bezeichnung', 'zeitstempel','stoerung'],['bezeichnung', 'zeitstempel','stoerung']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var WarentreagerWebSocket = new WebSocket(host+"WarentraegerWebSocket");
        var ArtikelWebSocket = new WebSocket(host+"ArtikelWebSocket");
        var TransportbandWebSocket = new WebSocket(host+"TransportbandWebSocket");
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        
        WarentreagerWebSocket.onopen = function() {
                WarentreagerWebSocket.send(id);
            };

        ArtikelWebSocket.onopen = function() {
                ArtikelWebSocket.send("LIST");
            };
            
        TransportbandWebSocket.onopen = function() {
                TransportbandWebSocket.send("LIST");
            };
            
        SektorWebSocket.onopen = function() {
                SektorWebSocket.send("LIST");
            };

        WarentreagerWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        ArtikelWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"warentraegerIDs");
        };
        
        TransportbandWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[1], jsonString, list_attribute[1],"warentraegerIDs");
        };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[2], jsonString, list_attribute[2],"warentraegerIDs");
        };
    }
    
    function initTransportbaender(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Störung', 'Länge', 'Geschwindigkeit', 'Sektor vorher', 'Sektor nachher'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'stoerung', 'laenge', 'geschwindigkeit', 'nachSektorID', 'vorSektorID'];

        //Einzelne Tabellen:
        var list_title = ['Warenträger'];
        var list_id    = ['warentraeger'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel']];
        var list_attribute = [['bezeichnung', 'zeitstempel']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var TransportbandWebSocket = new WebSocket(host+"TransportbandWebSocket");
        var WarentreagerWebSocket = new WebSocket(host+"WarentraegerWebSocket");
        
        TransportbandWebSocket.onopen = function() {
                TransportbandWebSocket.send(id);
            };
            
        WarentreagerWebSocket.onopen = function() {
                WarentreagerWebSocket.send("LIST");
            };

        TransportbandWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        WarentreagerWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"transportbandIDs");
        };
    }
    
    function initRoboter(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Störung', 'X', 'Y', 'Z', 'Ausrichtung'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'stoerung', 'x', 'y', 'z', 'ausrichtung'];

        //Einzelne Tabellen:
        var list_title = ['Sektoren','Gelenke','Werkzeug'];
        var list_id    = ['sektoren','gelenke','werkzeug'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel','Störung'], ['Bezeichnung', 'Zeitstempel','Gelenkstellung'], ['Bezeichnung', 'Zeitstempel','Zustand']];
        var list_attribute = [['bezeichnung', 'zeitstempel','stoerung'], ['bezeichnung', 'zeitstempel','gelenkstellung'], ['bezeichnung', 'zeitstempel','zustand']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var RoboterWebSocket = new WebSocket(host+"RoboterWebSocket");
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        var GelenkWebSocket = new WebSocket(host+"GelenkWebSocket");
        //var WerkzeugWebSocket = new WebSocket(host+"WerkzeugWebSocket");
        
        RoboterWebSocket.onopen = function() {
                RoboterWebSocket.send(id);
            };
            
        SektorWebSocket.onopen = function() {
                SektorWebSocket.send("LIST");
            };
            
        GelenkWebSocket.onopen = function() {
                GelenkWebSocket.send("LIST");
            };
            
       // WerkzeugWebSocket.onopen = function() {
       //         WerkzeugWebSocket.send("LIST");
       //     };

        RoboterWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"roboterIDs");
        };

        //TODO Fehler: Keine Liste
        /*GelenkWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[1], jsonString, list_attribute[1],"roboterIDs");
        };*/

        //WerkzeugWebSocket.onmessage = function(event) {
        //    var jsonString = event.data;
        //    updateList(id, list_id[2], jsonString, list_attribute[2],"roboterIDs");
        //};
    }
    
    function initSektoren(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Störung', 'X', 'Y', 'Z', 'Ausrichtung'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'stoerung', 'x', 'y', 'z', 'ausrichtung'];

        //Einzelne Tabellen:
        var list_title = ['Warenträger','Hubpodest','Hubquerpodest','Roboter','Sensor','Transportband vorher','Tansportband nachher'];
        var list_id    = ['warentraeger','hubpodest','hubquerpodest','roboter','sensor','nachTransportband','vorTransportband'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel'], 
                               ['Bezeichnung', 'Zeitstempel','Oben'],
                               ['Bezeichnung', 'Zeitstempel','Oben'],
                               ['Bezeichnung', 'Zeitstempel','Störung'],
                               ['Bezeichnung', 'Zeitstempel','Zustand'],
                               ['Bezeichnung', 'Zeitstempel','Störung'],
                               ['Bezeichnung', 'Zeitstempel','Störung']
                              ];
        var list_attribute = [['bezeichnung', 'zeitstempel'], 
                               ['bezeichnung', 'zeitstempel','oben'],
                               ['bezeichnung', 'zeitstempel','oben'],
                               ['bezeichnung', 'zeitstempel','stoerung'],
                               ['bezeichnung', 'zeitstempel','zustand'],
                               ['bezeichnung', 'zeitstempel','stoerung'],
                               ['bezeichnung', 'zeitstempel','stoerung']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        
        var WarentraegerWebSocket = new WebSocket(host+"WarentraegerWebSocket");
        var HubpodestWebSocket = new WebSocket(host+"HubPodestWebSocket");
        var HubquerpodestWebSocket = new WebSocket(host+"HubQuerPodestWebSocket");
        var RoboterWebSocket = new WebSocket(host+"RoboterWebSocket");
        var SensorWebSocket = new WebSocket(host+"SensorWebSocket");
        var TransportbandWebSocket = new WebSocket(host+"TransportbandWebSocket");
        
        SektorWebSocket.onopen = function() {
                SektorWebSocket.send(id);
            };
            
        WarentraegerWebSocket.onopen = function() {
                WarentraegerWebSocket.send("LIST");
            };
            
        HubpodestWebSocket.onopen = function() {
                HubpodestWebSocket.send("LIST");
            };
            
        HubquerpodestWebSocket.onopen = function() {
                HubquerpodestWebSocket.send("LIST");
            };
            
        RoboterWebSocket.onopen = function() {
                RoboterWebSocket.send("LIST");
            };
            
        SensorWebSocket.onopen = function() {
                SensorWebSocket.send("LIST");
            };
            
        TransportbandWebSocket.onopen = function() {
                TransportbandWebSocket.send("LIST");
            };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        WarentraegerWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"sektorIDs");
        };

        //TODO: Fehler keine liste
        /*HubpodestWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[1], jsonString, list_attribute[1],"sektorIDs");
        };*/

        //TODO: Fehler keine liste
        /*HubquerpodestWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[2], jsonString, list_attribute[2],"sektorIDs");
        };*/

        RoboterWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[3], jsonString, list_attribute[0],"sektorIDs");
        };

        SensorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[4], jsonString, list_attribute[4],"sektorIDs");
        };

        TransportbandWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[5], jsonString, list_attribute[5],"vorSektorID");
            updateList(id, list_id[6], jsonString, list_attribute[6],"nachSektorID");
        };
    }
    
    function initGelenke(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Typ', 'Nummer', 'Gelenkstellung'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'typ', 'nummer', 'gelenkstellung'];

        //Einzelne Tabellen:
        var list_title = ['Roboter'];
        var list_id    = ['roboter'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel','Störung']];
        var list_attribute = [['bezeichnung', 'zeitstempel','stoerung']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var GelenkWebSocket = new WebSocket(host+"GelenkWebSocket");
        var RoboterWebSocket = new WebSocket(host+"RoboterWebSocket");
        
        GelenkWebSocket.onopen = function() {
                GelenkWebSocket.send(id);
            };
            
        RoboterWebSocket.onopen = function() {
                RoboterWebSocket.send("LIST");
            };

        GelenkWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        RoboterWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"gelenkIDs");
        };
    }
    
    function initWerkzeuge(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Zustand'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'zustand'];

        //Einzelne Tabellen:
        var list_title = ['Roboter'];
        var list_id    = ['roboter'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel','Störung']];
        var list_attribute = [['bezeichnung', 'zeitstempel','stoerung']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var WerkzeugWebSocket = new WebSocket(host+"WerkzeugWebSocket");
        var RoboterWebSocket = new WebSocket(host+"RoboterWebSocket");
        
        WerkzeugWebSocket.onopen = function() {
                WerkzeugWebSocket.send(id);
            };
            
        RoboterWebSocket.onopen = function() {
                RoboterWebSocket.send("LIST");
            };

        WerkzeugWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        RoboterWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"werkzeugIDs");
        };
    }
    
    function initHuPo(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Oben', 'Unten'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'oben', 'unten'];

        //Einzelne Tabellen:
        var list_title = ['Sektor'];
        var list_id    = ['Sektor'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel']];
        var list_attribute = [['bezeichnung', 'zeitstempel']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var HubpodestWebSocket = new WebSocket(host+"HubPodestWebSocket");
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        
        HubpodestWebSocket.onopen = function() {
                HubpodestWebSocket.send(id);
            };
            
        SektorWebSocket.onopen = function() {
                SektorWebSocket.send("LIST");
            };

        HubpodestWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"hubpodestIDs");
        };
    }
    
    function initHuQu(id){
        //Einzelne Attribute:
        var attribute_title = ['Bezeichnung', 'Zeitstempel', 'User Parameter', 'Oben', 'Mittig','Unten','Motor'];
        var attribute_id    = ['bezeichnung', 'zeitstempel', 'user_parameter', 'oben', 'mittig','unten','motor'];

        //Einzelne Tabellen:
        var list_title = ['Sektor'];
        var list_id    = ['Sektor'];

        //Eigenschaften der Tabellen
        var list_header     = [['Bezeichnung', 'Zeitstempel']];
        var list_attribute = [['bezeichnung', 'zeitstempel']];

        //Tabelle Erstellen
        create(attribute_title, attribute_id, list_title, list_id, list_header);

        //WebSockets
        var HubQuerPodestWebSocket = new WebSocket(host+"HubQuerPodestWebSocket");
        var SektorWebSocket = new WebSocket(host+"SektorWebSocket");
        
        HubQuerPodestWebSocket.onopen = function() {
                HubQuerPodestWebSocket.send(id);
            };
            
        SektorWebSocket.onopen = function() {
                SektorWebSocket.send("LIST");
            };

        HubQuerPodestWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateAttributes(attribute_id,jsonString);
        };

        SektorWebSocket.onmessage = function(event) {
            var jsonString = event.data;
            updateList(id, list_id[0], jsonString, list_attribute[0],"hubquerpodestIDs");
        };
    }
    
    function init(){
        $val = 'Artikel';
        switch ($val) {
            case 'Artikel':
                var id = 1;
                initArtikel(id);
                break;
            case "Warenträger":
                var id = 1;
                initWarentraeger(id);
                break;
            case "Transportbänder":
                var id = 2;
                initTransportbaender(id);
                break;
            case "Roboter":
                var id = 1;
                initRoboter(id);
                break;
            case "Sektoren":
                var id = 1;
                initSektoren(id);
                break;
            case "Sensoren":
                var id = 2;
                initSensor(id);
                break;
            case "Gelenke":
                var id = 1;
                initGelenke(id);
                break;
            case "Werkzeuge":
                var id = 1;
                initWerkzeuge(id);
                break;
            case "Hubpositionierstationen":
                var id = 1;
                initHuPo(id);
                break;
            case "Hub-Quer-Stationen":
                var id = 1;
                initHuQu(id);
                break;
            default:

      }
    }
        
        
           

    $(document).ready(function(){
        console.log("Start");
        init();
    });
    
  </script>
</html>