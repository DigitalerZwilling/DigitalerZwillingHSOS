<html>
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>
  <body id="body"> 
      <table id="attributes" border="0"></table><br/>
      <div id="lists"></div>
  </body>
  
  <script language="javascript"> 
      var attribute;
      var id;
      var list;
      var listid;
      var childheader;
      var childAttributes;
      
      //Browserunterstuetzung vorhanden?
      var browserSupport = ("WebSocket" in window) ? true : false;
            
      //Deklariere WebSocket
       var host = "ws://localhost:8080/DigitalerZwilling/";
    
      
      var ArtikelWebSocket;
      var WarentraegerWebSocket;
      
      
      
      
    function createAttributes(attribute, id){
        var attributes = document.getElementById("attributes");
        
        
        for(var i=0; i<attribute.length; i++){
            var zeile = document.createElement("tr");
            var name = document.createElement("td");
            name.innerHTML = attribute[i];
            zeile.appendChild(name);

            var value = document.createElement("td");
            value.id = id[i];
            zeile.appendChild(value);

            attributes.appendChild(zeile);
        }
    }
        
    function createLists(list, listid){
        if(list.length !== listid.length) return;
        
        var lists = document.getElementById("lists");
        
        for(var i=0; i<list.length; i++){
            var name = document.createTextNode(list[i]);
            lists.appendChild(name);
            var table = document.createElement("table");
            table.id = listid[i];            
            lists.appendChild(table);
            lists.appendChild(document.createElement("br"));
            setHeader(childheader[i], table);
        }
        
    }
    
    function removeList(parent){
            var childs = parent.childNodes;
            console.log("Remove:"+childs.length);
            
            while(childs.length>1){
                parent.removeChild(childs[1]);
            }
    }
    
    function setHeader(headerlist, parentNode){
            var tr = document.createElement("tr");
            for(var i=0; i<headerlist.length; i++){
                var th = document.createElement("th");
                th.innerHTML = headerlist[i];
                tr.appendChild(th);
            }
            parentNode.appendChild(tr);
    }
    
    function addLine(jsonObject, attributes, parentNode){
            var zeile = document.createElement("tr");
            for(var k=0; k<attributes.length; k++){
                var element = document.createElement("td");
                element.innerHTML = jsonObject[attributes[k]];
                zeile.appendChild(element);
            }
            parentNode.appendChild(zeile);
    }
    
 
    
    function updateAttributes(id, jsonString){
        var json = JSON.parse(jsonString);
        
        //Update Attributes
        for(var i=0; i<id.length; i++){
            var element = document.getElementById(id[i]);
            element.innerHTML = json[id[i]];
        }
    }
    
    function updateLists(listid, childheader, childString, childAttributes, elementid, elementid_key){
        if(childheader.length !== childAttributes.length || listid.length !== childheader.length) return;
        for(var i=0; i<listid.length; i++){
            
        }
    }
    
    function create(attribute, id, list, listid, childheader, childAttributes){
        createAttributes(attribute,id);
        createLists(list, listid);
        updateLists(listid, childheader, ["{\"inhalt\":[{}]}"], childAttributes);
    }
    
    function init(){
        $val = 'Artikel';
        switch ($val) {
            case 'Artikel':
                //Einzelne Attribute:
                attribute = ['Bezeichnung', 'Zeitstempel', 'User Parameter'];
                id =        ['bezeichnung', 'zeitstempel', 'user_paramenter'];
                
                //Einzelne Tabellen:
                list =   ['Wartenträger' ];
                listid = ['wartentraeger'];
                
                //Eigenschaften der Tabellen
                childheader     = [['Bezeichnung', 'Zeitstempel']];
                childAttributes = [['bezeichnung', 'zeitstempel']];
                
                //JSONStrings
                var childString = ['{"inhalt": [{"id":1, "bezeichnung":"WT1" , "zeitstempel":"14:21:03"},{"id":2, "bezeichnung":"WT2" , "zeitstempel":"15:33:02"}]}'];
                
                //Tabelle Erstellen
                create(attribute, id, list, listid, childheader, childAttributes);
                
                //WebSockets
                ArtikelWebSocket = new WebSocket(host+"ArtikelWebSocket");
                WarentraegerWebSocket = new WebSocket(host+"WarentraegerWebSocket");
                
                ArtikelWebSocket.onopen = function() {
                        ArtikelWebSocket.send("1");
                    };
                    
                WarentraegerWebSocket.onopen = function() {
                        WarentraegerWebSocket.send("LIST");
                    };
                    
                ArtikelWebSocket.onmessage = function(event) {
                var jsonString = event.data;
                    updateAttributes(id,jsonString);
                };
                
                ArtikelWebSocket.onclose = function() {
                };    
                WarentraegerWebSocket.onclose = function() {
                };
                    
                WarentraegerWebSocket.onmessage = function(event) {
                //var jsonString = event.data;
                var jsonString = '{"inhalt":[{"id": 1,"bezeichnung": "WT1","user_Parameter": "null","zeitstempel": "2016-12-22T12:43:34.712","stoerung": 0,"abstand_mm": 100,"montagezustand": 0,"artikelIDs": [4,1,2,3],"transportbandIDs": [],"sektorIDs": []},{"id": 2,"bezeichnung": "WT2","user_Parameter": "null","zeitstempel": "2016-12-22T12:43:41.275","stoerung": 1,"abstand_mm": 0,"montagezustand": 1,"artikelIDs": [1,4,5,6],"transportbandIDs": [],"sektorIDs": []}]}';
                    var json = JSON.parse(jsonString);
                    var parent = document.getElementById(listid[0]);
                    removeList(parent);
                    
                    console.log(json.inhalt.length);
                    for(var i=0; i<json.inhalt.length; i++){
                        var artikelIDs = json.inhalt[i].artikelIDs;
                        console.log(artikelIDs.length);
                        for(var j=0; j<artikelIDs.length; j++){
                            if(artikelIDs[j]==1){
                                console.log(json.inhalt[i]);
                                addLine(json.inhalt[i],childAttributes[0],parent);
                            }
                        }
                    }
                };
                
                break;
            case "Warenträger":
                erzeugeTabelleWarentraeger();
                break;
            case "Transportbänder":
                erzeugeTabelleTransportbaender();
                break;
            case "Roboter":
                erzeugeTabelleRoboter();
                break;
            case "Sektoren":
                erzeugeTabelleSektoren();
                break;
            case "Sensoren":
                erzeugeTabelleSensoren();
                break;
            case "Gelenke":
                erzeugeTabelleGelenke();
                break;
            case "Werkzeuge":
                erzeugeTabelleWerkzeuge();
                break;
            case "Hubpositionierstationen":
                erzeugeTabelleHubpositionierstationen();
                break;
            case "Hub-Quer-Stationen":
                erzeugeTabelleHubQuerStationen();
                break;
            default:
                document.getElementById("spalte1").innerHTML = 'Fehler beim Darstellen der Tabelle';

      }
    }
        
        
           

    $(document).ready(function(){
        console.log("Start");
        init();
    });
    
  </script>
</html>