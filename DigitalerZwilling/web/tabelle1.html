<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>

<!-- TODO: - WebSocketseinbauen
           - bei Hubpodest und Hubquerpodest Pfeile für die Darstellung benutzten
 -->

<body> 
    <table class="table table-striped" width="100" border="0" cellpadding="0" cellspacing="1" id="tabelle">
    <!--Tabelle an der die Daten angehangen werden -->
        <thead>
            <tr>
                <th id = "spalte1.1"></th>
                <th id = "spalte1.2"></th>
                <th id = "spalte1.3"></th> 
            </tr>
        </thead>
    </table>
</body>

<script language="javascript">


      //Browserunterstuetzung vorhanden?
      var browserSupport = ("WebSocket" in window) ? true : false;
            
      //Deklariere WebSocket
       var host = "ws://localhost:8080/DigitalerZwilling/";     



   $(document).ready(function(){
        console.log("Start");
       //tabelle1.html muss über Test_Aufbau.html aufgerufen werden
       
        switch ($val) {
            
            var artikelTabelleErzeugt = 0;
              
            case 'Artikel':
                var ArtikelWebSocket = new WebSocket(host+"ArtikelWebSocket");

                ArtikelWebSocket.onopen = function() {
                    ArtikelWebSocket.send("LIST");
                };
                
                ArtikelWebSocket.onmessage = function(event) {
                    var jsonListe = event.data;
                    if (artikelTabelleErzeugt == 0){
                            createTabelle("Artikel", jsonListe);
                            artikelTabelleErzeugt = 1;
                        }
                    else{
                        updateTabelle("Artikel", jsonListe);
                    }

                };
                break;


            case "Warenträger":
                //Durch WebSockets ersetzten!
                var warentraegerListeJSON = '{ "inhalt" : [' +
                '{  "id":"1" ,"bezeichnung":"WT_1" , "zeitstempel":"14:21:03" , "montagezustand":"60%" },' +
                '{  "id":"2" ,"bezeichnung":"WT_2" , "zeitstempel":"14:22:05" , "montagezustand":"60%" },' +
                '{  "id":"3" ,"bezeichnung":"WT_3" , "zeitstempel":"14:21:23" , "montagezustand":"60%" },' +
                '{  "id":"4" ,"bezeichnung":"WT_4" , "zeitstempel":"14:23:16" , "montagezustand":"60%" } ]}';

                //Erzeugen der Tabelle:
                erzeugeTabelle("Warentraeger", warentraegerListeJSON);

                //Durch WebSockets ersetzten!
                var neueListeJSON = '{ "inhalt" : [' +
                '{  "id":"1" ,"bezeichnung":"WT_1" , "zeitstempel":"14:21:05" , "montagezustand":"65%" },' +
                '{  "id":"2" ,"bezeichnung":"WT_2" , "zeitstempel":"14:22:07" , "montagezustand":"60%" },' +
                '{  "id":"3" ,"bezeichnung":"WT_3" , "zeitstempel":"14:21:25" , "montagezustand":"65%" },' +
                '{  "id":"4" ,"bezeichnung":"WT_4" , "zeitstempel":"14:23:18" , "montagezustand":"60%" } ]}';

                //Update der Tabelleninhalte:
                updateTabelle("Warentraeger", neueListeJSON); 

                break;

            case "Transportbänder":
                var transportbaenderListeJSON = '';
                erzeugeTabelle("Transportband", transportbaenderListeJSON);

                var neueListeJSON = '';
                updateTabelle("Transportband", neueListeJSON); 
                break;

            case "Roboter":
                var roboterListeJSON = '';
                erzeugeTabelle("Roboter", roboterListeJSON);

                var neueListeJSON = '';
                updateTabelle("Roboter", neueListeJSON); 
                break;

            case "Sektoren":
                var sektorenListeJSON = '';
                erzeugeTabelle("Sektor", sektorenListeJSON);

                var neueListeJSON = '';
                updateTabelle("Sektoren", neueListeJSON); 
                break;

            case "Sensoren":
             var sensorenListeJSON = '';
                erzeugeTabelle("Sensor", sensorenListeJSON);

                var neueListeJSON = '';
                updateTabelle("Sensor", neueListeJSON); 
                break;

            case "Gelenke":
             var gelenkeListeJSON = '';
                erzeugeTabelle("Gelenk", gelenkeListeJSON);

                var neueListeJSON = '';
                updateTabelle("Gelenk", neueListeJSON); 
                break;

            case "Werkzeuge":
             var werkzeugeListeJSON = '';
                erzeugeTabelle("Werkzeug", werkzeugeListeJSON);

                var neueListeJSON = '';
                updateTabelle("Werkzeug", neueListeJSON); 
                break;

            case "Hubpositionierstationen":
              var hubpositionierstationenListeJSON = '';
                erzeugeTabelle("Hubpositionierstation", hubpositionierstationenListeJSON);

                var neueListeJSON = '';
                updateTabelle("Hubpositionierstation", neueListeJSON); 
                break;

            case "Hub-Quer-Stationen":
            var hubQuerStationenListeJSON = '';
                erzeugeTabelleHubQuer("HubQuerStation", hubQuerStationenListeJSON);

                var neueListeJSON = '';
                updateTabelle("HubQuerStation", neueListeJSON); 
                break;
            default:
                document.getElementById("spalte1").innerHTML = 'Fehler beim Darstellen der Tabelle';

      }
    });



    /* ------------------------------ERZEUGE TABELLE -------------------------------- */
    function erzeugeTabelle(typ, listeJSON){

        var liste = JSON.parse(listeJSON);
        var spaltennamen = getSpaltenname(typ);

        //Erstellen der Tabelle
        node = document.getElementById("tabelle");
        node.parentNode.insertBefore(createTable(typ, liste, spaltennamen, liste.inhalt.length, spaltennamen.length), node);

    }

    function getSpaltenname(typ){
        var spaltennamen;
         switch (typ) {
            case 'Artikel':
                spaltennamen = ['Bezeichnung', 'Zeitstempel']; 
                return spaltennamen;
            case "Warentraeger":
               spaltennamen =  ['Bezeichnung', 'Zeitstempel', 'Montagezustand'];
                return spaltennamen;
            case "Transportband":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Roboter":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Sektor":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Sensor":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Zustand']; 
                return spaltennamen;
            case "Gelenk":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Gelenkstellung'];
                return spaltennamen;
            case "Werkzeug":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Zustand'];
                return spaltennamen;
            case "Hubpositionierstation":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Position'];
                return spaltennamen;
            case "Hub-Quer-Station":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Motor'];
                return spaltennamen;
            default:
                document.getElementById("spalte1").innerHTML = 'Fehler beim Darstellen der Tabelle';
      }
    }




/* ------------------------------UPDATE TABELLE -------------------------------- */
    function updateTabelle(typ, listeJSON){

        console.log("updateTabelle");
        var liste = JSON.parse(listeJSON);

        var anzahlElemente = liste.inhalt.length;

        //Aktualisieren der Werte:
        for (var i = 0; i < anzahlElemente; i++){
            document.getElementById(typ+"Bezeichnung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].bezeichnung;
            document.getElementById(typ+"Zeitstempel_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zeitstempel;

              switch (typ) {
                case "Artikel":
                    break;
                case "Warentraeger":
                    document.getElementById("WarentraegerMontagezustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].montagezustand;
                    break;
                case "Transportband":
                    document.getElementById("TransportbandStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Roboter":
                    document.getElementById("RoboterStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Sektor":
                    document.getElementById("SektorStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Sensor":
                    document.getElementById("SensorZustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zustand;
                    break;
                case "Gelenk":
                    document.getElementById("GelenkStellung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].gelenkstellung;
                    break;
                case "Werkzeug":
                    document.getElementById("WerkzeugZustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zustand;
                    break;
                case "Hubpositionierstation":
                   /*TODO*/
                   break;
                case "Hub-Quer-Station":
                    //TODO
                    break;
                default:
                    document.getElementById("spalte1.3").innerHTML = 'Fehler im switch case';                      
           } 
        }
    }


    /*function holeTabelleRoboter() {
        node = document.getElementById("tabelle");
        node.parentNode.insertBefore(roboterTabelle, node);

        Timer = setTimeout('updateTabelleRoboter()', 2000);
    }*/



    //-------------TABELLENERZEUGUNG-----------------------------------------------------
    function createTable(typ, liste, spaltennamen, row, col) {

        console.log("In CreateTable mit Typ: " + typ);
        //Gibt den Spalten, die im Body erzeugt wurden die jeweiligen Namen
        if (spaltennamen < 2){
            console.log("Fehler: spaltennamen < 2");
        }else{
            document.getElementById("spalte1.1").innerHTML = spaltennamen[0];
            document.getElementById("spalte1.2").innerHTML = spaltennamen[1];
        }

        //Falls eine dritte Spalte benötigt wird:
        if (spaltennamen.length == 3){
            document.getElementById("spalte1.3").innerHTML = spaltennamen[2];
        }

        var myTable = document.getElementById("tabelle"); //holt sich die im Body erstellte Tabelle
            
            /*
            if (document.getElementsByTagName("tbody")[0] != null){
                var zeile = document.getElementsByTagName("tbody")[0];
                zeile.parentNode.removeChild(zeile);
            }*/

            var mytablebody = document.createElement("tbody");

            for(var j = 0; j < row; j++) {
                 mycurrent_row = document.createElement("tr");     

                for(var i = 0; i < col; i++) {
                        mycurrent_cell = document.createElement("td");

                      

                        //1.Spalte - Bezeichnung:
                        if (i == 0){
                            mycurrent_cell.setAttribute('id', typ+"Bezeichnung_"+liste.inhalt[j].id);
                            console.log("My current_cell: " + mycurrent_cell.id);
                            currenttext = document.createTextNode(liste.inhalt[j].bezeichnung);
                        }

                        //2.Spalte - Zeitstempel:
                        if (i == 1){
                            mycurrent_cell.setAttribute('id', typ+"Zeitstempel_"+liste.inhalt[j].id);
                            console.log("My current_cell: " + mycurrent_cell.id);
                            currenttext = document.createTextNode(liste.inhalt[j].zeitstempel);
                        }
                     
                        //3.Spalte:
                        if (i == 2){
                            switch (spaltennamen[2]) {
                                case 'Montagezustand':
                                    mycurrent_cell.setAttribute('id', typ+"Montagezustand_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].montagezustand);
                                    break;
                                case "Zustand":
                                    mycurrent_cell.setAttribute('id', typ+"Zustand_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].zustand);
                                    break;
                                case "Stoerung":
                                    mycurrent_cell.setAttribute('id', typ+"Stoerung_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].stoerung);
                                    break;
                                case "Gelenkstellung":
                                   mycurrent_cell.setAttribute('id', typ+"Gelenkstellung_"+liste.inhalt[j].id);
                                   currenttext = document.createTextNode(liste.inhalt[j].gelenkstellung);
                                    break;
                                case "Position":
                                  // TODO:  mycurrent_cell.setAttribute('id', "stoerung_"+liste.inhalt[j].id);
                                    //TODO: muss noch durch Symbole ersetzt werden!
                                   currenttext = document.createTextNode(liste.inhalt[j].oben + "-" + liste.inhalt[j].unten);
                                    break;
                                case "Motor":
                                   //TODO: mycurrent_cell.setAttribute('id', "stoerung_"+liste.inhalt[j].id);
                                    //TODO: muss noch durch Symbole ersetzt werden!
                                   currenttext = document.createTextNode(liste.inhalt[j].motor + "-" + liste.inhalt[j].oben + "-" + liste.inhalt[j].mittig + "-" + liste.inhalt[j].unten);
                                    break;
                                default:
                                 document.getElementById("spalte1.3").innerHTML = 'Fehler im switch case';
                                    
                            } 
                        }
                        mycurrent_cell.appendChild(currenttext); //akt. Text wird an Zeile angehangen
                        mycurrent_row.appendChild(mycurrent_cell); //akt. Zeile wird an Spalte angehangen
                }
                mytablebody.appendChild(mycurrent_row); //komplette Spalte wird an Tabellenbody angehangen
        }
        myTable.appendChild(mytablebody); //kompletter Tabellenbody mit allen Spalten wird an die schon existierende Tabelle angehangen

        return myTable;
    }

</script> 
</html>

