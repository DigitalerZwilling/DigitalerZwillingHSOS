<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>

<!-- TODO: - WebSockets mit einbringen und die bisher genutztenJSON-Arrays löschen
           - bei Hubpodest und Hubquerpodest Pfeile für die Darstellung benutzten
 -->

<body> 
    <table class="table table-striped" width="100" border="0" cellpadding="0" cellspacing="1" id="tabelle1">
    <!--Tabelle an der die Daten angehangen werden -->
        <thead>
            <tr>
                <th id = "spalte1.1"></th>
                <th id = "spalte1.2"></th>
                <th id = "spalte1.3"></th> 
            </tr>
        </thead>
    </table>


</body>

<script language="javascript">

    var artikelErzeugt = 0;
    var warentraegerErzeugt = 0;
    var transportbaenderErzeugt = 0;
    var browsersupport = ("WebSocket" in window) ? true : false;
    
    //Zugriff auf Elemente der HTML-Seite
    var messages = document.getElementById("messages");
            
    //Deklariere WebSocket
    var host = "ws://localhost:8080/DigitalerZwilling/";
    var wSocket = new WebSocket(host+"ArtikelWebSocket");
    var warentraegerWebSocket = new WebSocket(host+"WarentraegerWebSocket");
    var transportbandWebSocket = new WebSocket(host+"TransportbandWebSocket");



   $(document).ready(function(){
        console.log("Start");
        
        switch ($val) {
            case 'Artikel':
                wSocket.onopen = function() {
                    wSocket.send("LIST");
                };
                
                wSocket.onmessage = function(event) {
                    var received_msg = event.data;
                    console.log("Message"+received_msg);

                    if (artikelErzeugt == 0){
                        erzeugeTabelle("Artikel", received_msg);
                        artikelErzeugt = 1;
                    }
                    else{
                        updateTabelle("Artikel", received_msg);
                    }
                }
            break;
            
            case "Warenträger":
                warentraegerWebSocket.onopen = function() {
                    warentraegerWebSocket.send("LIST");
                };
                warentraegerWebSocket.onmessage = function(event) {
                var received_msg = event.data;
                console.log("Message"+received_msg);
                            if (warentraegerErzeugt == 0){
                                erzeugeTabelle("Warentraeger", received_msg);
                                warentraegerErzeugt = 1;
                            }
                            else{
                                updateTabelle("Warentraeger", received_msg);
                            }
                        }
                break;
            case "Transportbänder":
               transportbandWebSocket.onopen = function() {
                    transportbandWebSocket.send("LIST");
                };
                
                transportbandWebSocket.onmessage = function(event) {
                    var received_msg = event.data;
                    console.log("Message"+received_msg);
                        if (transportbaenderErzeugt == 0){
                            erzeugeTabelle("Artikel", received_msg);
                            transportbaenderErzeugt = 1;
                        }
                        else{
                            updateTabelle("Transportbaender", received_msg);
                        }
                }
                break;
            case "Roboter":
              
                break;
            case "Sektoren":
              
                break;
            case "Sensoren":
               
                break;
            case "Gelenke":
                
                break;
            case "Werkzeuge":
               
                break;
            case "Hubpositionierstationen":
               
                break;
            case "Hub-Quer-Stationen":
              
                break;
            default:
                document.getElementById("spalte1.1").innerHTML = 'Fehler beim Darstellen der Tabelle';

      }
      //init();
    });

    /* ------------------------------ERZEUGE TABELLE -------------------------------- */
    function erzeugeTabelle(typ, listeJSON){

        var liste = JSON.parse(listeJSON);
        var spaltennamen = getSpaltenname(typ);

        //Erstellen der Tabelle
        node = document.getElementById("tabelle1");
        node.parentNode.insertBefore(createTable(typ, liste, spaltennamen, liste.inhalt.length, spaltennamen.length), node);

    }

    function getSpaltenname(typ){
        var spaltennamen;
         switch (typ) {
            case 'Artikel':
                spaltennamen = ['Bezeichnung', 'Zeitstempel']; 
                return spaltennamen;
            case "Warentraeger":
               spaltennamen =  ['Bezeichnung', 'Zeitstempel', 'Montagezustand'];
                return spaltennamen;
            case "Transportband":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Roboter":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Sektor":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Stoerung'];
                return spaltennamen;
            case "Sensor":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Zustand']; 
                return spaltennamen;
            case "Gelenk":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Gelenkstellung'];
                return spaltennamen;
            case "Werkzeug":
                 spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Zustand'];
                return spaltennamen;
            case "Hubpositionierstation":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Position'];
                return spaltennamen;
            case "Hub-Quer-Station":
                spaltennamen = ['Bezeichnung', 'Zeitstempel', 'Motor'];
                return spaltennamen;
            default:
                document.getElementById("spalte1.1").innerHTML = 'Fehler beim Darstellen der Tabelle';
      }
    }
    
    /* ------------------------------UPDATE TABELLE -------------------------------- */
    function updateTabelle(typ, listeJSON){

        console.log("updateTabelle");
        var liste = JSON.parse(listeJSON);

        var anzahlElemente = liste.inhalt.length;

        //Aktualisieren der Werte:
        for (var i = 0; i < anzahlElemente; i++){
            document.getElementById(typ+"Bezeichnung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].bezeichnung;
            document.getElementById(typ+"Zeitstempel_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zeitstempel;

              switch (typ) {
                case "Artikel":
                    break;
                case "Warentraeger":
                    document.getElementById("WarentraegerMontagezustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].montagezustand;
                    break;
                case "Transportband":
                    document.getElementById("TransportbandStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Roboter":
                    document.getElementById("RoboterStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Sektor":
                    document.getElementById("SektorStoerung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].stoerung;
                    break;
                case "Sensor":
                    document.getElementById("SensorZustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zustand;
                    break;
                case "Gelenk":
                    document.getElementById("GelenkStellung_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].gelenkstellung;
                    break;
                case "Werkzeug":
                    document.getElementById("WerkzeugZustand_"+liste.inhalt[i].id).innerHTML = liste.inhalt[i].zustand;
                    break;
                case "Hubpositionierstation":
                   /*TODO*/
                   break;
                case "Hub-Quer-Station":
                    //TODO
                    break;
                default:
                    document.getElementById("spalte1.3").innerHTML = 'Fehler im switch case';                      
           } 
        }
    }
    
       //-------------TABELLENERZEUGUNG-----------------------------------------------------
    function createTable(typ, liste, spaltennamen, row, col) {

        console.log("In CreateTable mit Typ: " + typ);
        //Gibt den Spalten, die im Body erzeugt wurden die jeweiligen Namen
        if (spaltennamen < 2){
            console.log("Fehler: spaltennamen < 2");
        }else{
            document.getElementById("spalte1.1").innerHTML = spaltennamen[0];
            document.getElementById("spalte1.2").innerHTML = spaltennamen[1];
        }

        //Falls eine dritte Spalte benötigt wird:
        if (spaltennamen.length == 3){
            document.getElementById("spalte1.3").innerHTML = spaltennamen[2];
        }

        var myTable = document.getElementById("tabelle1"); //holt sich die im Body erstellte Tabelle
            
            
          /*  if (document.getElementsByTagName("tbody")[0] != null){
                var zeile = document.getElementsByTagName("tbody")[0];
                zeile.parentNode.removeChild(zeile);
            }*/

            var mytablebody = document.createElement("tbody");

            for(var j = 0; j < row; j++) {
                 mycurrent_row = document.createElement("tr");     

                for(var i = 0; i < col; i++) {
                        mycurrent_cell = document.createElement("td");

                      

                        //1.Spalte - Bezeichnung:
                        if (i == 0){
                            mycurrent_cell.setAttribute('id', typ+"Bezeichnung_"+liste.inhalt[j].id);
                            console.log("My current_cell: " + mycurrent_cell.id);
                            currenttext = document.createTextNode(liste.inhalt[j].bezeichnung);
                        }

                        //2.Spalte - Zeitstempel:
                        if (i == 1){
                            mycurrent_cell.setAttribute('id', typ+"Zeitstempel_"+liste.inhalt[j].id);
                            console.log("My current_cell: " + mycurrent_cell.id);
                            currenttext = document.createTextNode(liste.inhalt[j].zeitstempel);
                        }
                     
                        //3.Spalte:
                        if (i == 2){
                            switch (spaltennamen[2]) {
                                case 'Montagezustand':
                                    mycurrent_cell.setAttribute('id', typ+"Montagezustand_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].montagezustand);
                                    break;
                                case "Zustand":
                                    mycurrent_cell.setAttribute('id', typ+"Zustand_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].zustand);
                                    break;
                                case "Stoerung":
                                    mycurrent_cell.setAttribute('id', typ+"Stoerung_"+liste.inhalt[j].id);
                                    currenttext = document.createTextNode(liste.inhalt[j].stoerung);
                                    break;
                                case "Gelenkstellung":
                                   mycurrent_cell.setAttribute('id', typ+"Gelenkstellung_"+liste.inhalt[j].id);
                                   currenttext = document.createTextNode(liste.inhalt[j].gelenkstellung);
                                    break;
                                case "Position":
                                  // TODO:  mycurrent_cell.setAttribute('id', "stoerung_"+liste.inhalt[j].id);
                                    //TODO: muss noch durch Symbole ersetzt werden!
                                   currenttext = document.createTextNode(liste.inhalt[j].oben + "-" + liste.inhalt[j].unten);
                                    break;
                                case "Motor":
                                   //TODO: mycurrent_cell.setAttribute('id', "stoerung_"+liste.inhalt[j].id);
                                    //TODO: muss noch durch Symbole ersetzt werden!
                                   currenttext = document.createTextNode(liste.inhalt[j].motor + "-" + liste.inhalt[j].oben + "-" + liste.inhalt[j].mittig + "-" + liste.inhalt[j].unten);
                                    break;
                                default:
                                 document.getElementById("spalte1.3").innerHTML = 'Fehler im switch case';
                                    
                            } 
                        }
                        mycurrent_cell.appendChild(currenttext); //akt. Text wird an Zeile angehangen
                        mycurrent_row.appendChild(mycurrent_cell); //akt. Zeile wird an Spalte angehangen
                }
                mytablebody.appendChild(mycurrent_row); //komplette Spalte wird an Tabellenbody angehangen
        }
        myTable.appendChild(mytablebody); //kompletter Tabellenbody mit allen Spalten wird an die schon existierende Tabelle angehangen

        return myTable;
    }
    
    //------------WEBSOCEKTS-------------------------------------------------------
            
            //Initalisierung der WebSockets
        /*    function init(){
                if (browsersupport) {
                    //Oeffnen des WebSockets und Senden einer Nachricht
                    wSocket.onopen = function() {
                        wSocket.send("LIST");
                    };
                }
                else {
                    alert("WebSocket is NOT supported by your Browser:)");
                }
            }
            
            //called when a message is received
            wSocket.onmessage = function(event) {
                var received_msg = event.data;
                console.log("Message"+received_msg);
                    switch ($val) {
                        case 'Artikel':
                            if (artikelTabelleErzeugt == 0){
                                erzeugeTabelle("Artikel", received_msg);
                                artikelTabelleErzeugt = 1;
                            }
                            else{
                                updateTabelle("Artikel", received_msg);
                            }
                            break;
                        case "Warenträger":
                            erzeugeTabelleWarentraeger();
                            break;
                        case "Transportbänder":
                            erzeugeTabelleTransportbaender();
                            break;
                        case "Roboter":
                            erzeugeTabelleRoboter();
                            break;
                        case "Sektoren":
                            erzeugeTabelleSektoren();
                            break;
                        case "Sensoren":
                            erzeugeTabelleSensoren();
                            break;
                        case "Gelenke":
                            erzeugeTabelleGelenke();
                            break;
                        case "Werkzeuge":
                            erzeugeTabelleWerkzeuge();
                            break;
                        case "Hubpositionierstationen":
                            erzeugeTabelleHubpositionierstationen();
                            break;
                        case "Hub-Quer-Stationen":
                            erzeugeTabelleHubQuerStationen();
                            break;
                        default:
                            document.getElementById("spalte1").innerHTML = 'Fehler beim Darstellen der Tabelle';

          }
            };*/
    
            // websocket is closed.
            wSocket.onclose = function() {
                alert("Connection is closed...");
            };
            
            //Send something to the WebSocket 
            function send(){
                wSocket.send("GET");
            }

</script> 
</html>

